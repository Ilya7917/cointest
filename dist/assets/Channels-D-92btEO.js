import{u as m,j as Y,k,D as q,d as z,l as E,E as G,g as b,h as K,q as O,c,a as s,t as h,F as j,p as R,b as I,m as w,x as J,v as S,G as Q,H as L,A as X,o as d,y as Z,z as ee,_ as te}from"./index-mhbRXU0K.js";import{A as se}from"./addIcon-B-w5o2bP.js";const ne="/assets/sprite-BbW-irAG.svg",ae=m(),{setUser:le}=ae,ie=Y("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:n=>n.myChannels},actions:{async fetchChannels(){const n=m(),a=await k.get("https://taptaptap.testcoin.uk/channels",{headers:{"x-api-key":n.getAccessToken}});this.channels=a.data},async fetchWhales(){const n=m(),a=await k.get("https://taptaptap.testcoin.uk/whales",{headers:{"x-api-key":n.getAccessToken}});this.whales=a.data,console.log(a.data)},async startChannel(n){const a=m(),e=await k.post("https://taptaptap.testcoin.uk/initUserChannel",{id:n.id},{headers:{"x-api-key":a.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(n,a,e){const y=m(),r=await k.post("https://taptaptap.testcoin.uk/createWhale",{title:n,link:a,rewarded:e},{headers:{"x-api-key":y.getAccessToken}});return console.log(r),!!r.data.sucess},async getMyChannels(){const n=m(),a=await k.get("https://taptaptap.testcoin.uk/getMyChannels",{headers:{"x-api-key":n.getAccessToken}});this.myChannels=q(a.data.channels)},async rewardChannel(n){const a=m(),e=await k.post("https://taptaptap.testcoin.uk/getRewardFromChannel",{id:n.id},{headers:{"x-api-key":a.getAccessToken}});return console.log(e.data),le(e.data.user),this.myChannels=e.data.channels,!0}}});function B(n){const a=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&a==="[object Date]"?new n.constructor(+n):typeof n=="number"||a==="[object Number]"||typeof n=="string"||a==="[object String]"?new Date(n):new Date(NaN)}const oe=36e5;function re(n){return a=>{const y=(n?Math[n]:Math.trunc)(a);return y===0?0:y}}function ce(n,a){return+B(n)-+B(a)}function de(n,a,e){const y=ce(n,a)/oe;return re(e==null?void 0:e.roundingMethod)(y)}const x=n=>(Z("data-v-ee182305"),n=n(),ee(),n),W=ne+"#chevron-right",ue={class:"telegram-channels",style:{overflowY:"hidden"}},he={class:"earn-title"},pe={style:{display:"flex",flexDirection:"column"}},ve={style:{flex:"0 0 70%",overflowY:"auto"}},fe={class:"channels-title"},_e={key:0,class:"channels-list"},ye=["onClick"],we={class:"channel-info"},me={class:"name"},Ce={class:"channel-action"},ge={key:0,class:"reward"},ke=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":W})],-1)),xe={style:{flex:"1 0 80%"}},be={style:{display:"flex",justifyContent:"space-between"}},Se={class:"channels-title"},De=["src"],Ae={key:0,class:"channels-list",style:{height:"45vh",overflowY:"scroll"}},Ie=["onClick"],Le={class:"channel-info"},Te={class:"name"},$e={class:"channel-action"},Me={key:0,class:"reward"},je=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":W})],-1)),Re={class:"popup-content"},Be={class:"popup-header"},We=x(()=>s("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[s("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Ve=[We],Ne={key:0,class:"popup-body"},Ue={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Fe=x(()=>s("label",{for:"fname"},"Название канала",-1)),He={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Pe=x(()=>s("label",{for:"fname"},"Ссылка на канал",-1)),Ye={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},qe=x(()=>s("label",{for:"fname"},"Цена за переход",-1)),ze=z({__name:"Channels",setup(n){const{t:a}=E(),e=ie(),y=G(),r=b(!1),D=b(!1),i=b({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:""}),T=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var o,p,v,f;((o=e.myChannels)==null?void 0:o.length)!=null&&((p=e.myChannels)==null?void 0:p.length)>0&&((v=e.myChannels)==null||v.map(t=>{var g,M;if(console.log(t),t.Status=="init"){let _=(g=e.channels)==null?void 0:g.findIndex(A=>A.id==t.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!0,console.log(e.channels[_].is_available))}if(t.Status=="rewarded"){let _=(M=e.channels)==null?void 0:M.findIndex(A=>A.id==t.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!1,console.log(e.channels[_].is_available))}}));let l=[];(f=e.channels)==null||f.map(t=>{t.is_whale&&l.push(t)}),e.whales=l.length>0?l:[],console.log(e.whales),D.value=!0})})};K(()=>{T()});const $=(l,o)=>{var p,v,f;if(((p=e.myChannels)==null?void 0:p.length)!=null&&((v=e.myChannels)==null?void 0:v.length)>0){let t=e.myChannels.findIndex(g=>g.ChannelID==l.id);t!=-1&&(i.value.status=e.myChannels[t].Status,i.value.createdAt=((f=e.myChannels[t].CreatedAt)==null?void 0:f.toLocaleString())||"")}i.value.id=l.id,i.value.reward=l.reward,i.value.title=l.title,i.value.invite_link=l.invite_link,r.value=!1,C.value=o,setTimeout(N,100),console.log(r)},V=()=>{const l={id:i.value.id,title:i.value.title,invite_link:i.value.invite_link,reward:0,is_available:!0,is_whale:!1};e.startChannel(l).then(o=>{o&&(r.value=!1,y.openTelegramLink(i.value.invite_link),e.getMyChannels())})},N=()=>{r.value=!0};function U(){C.value!="create"&&(r.value=!1)}const F=()=>{console.log("check time: "+i.value.createdAt);const l=new Date(i.value.createdAt),p=de(new Date,l);if(console.log("check time: "+i.value.createdAt),console.log("Hours since request: "+p),p>=1){const v={id:i.value.id,title:i.value.title,invite_link:i.value.invite_link,reward:0,is_available:!0,is_whale:!1};e.rewardChannel(v).then(()=>{if(console.log("request finished"),r.value=!1,e.channels){var f=e.channels.findIndex(t=>t.id==i.value.id);e.channels[f].is_available=!1}})}else X().showAlert(a("earn.waitRewardText"))},C=b("visible"),H=()=>{console.log(11111111),C.value="create",r.value=!0},u=b({title:"",link:"",rewared:0}),P=()=>{u.value.title==""||u.value.link==""||u.value.rewared==0||e.createWhale(u.value.title,u.value.link,u.value.rewared).then(l=>{l&&(T(),r.value=!1)})};return(l,o)=>{var v,f;const p=O("click-outside");return d(),c("div",ue,[s("div",he," 🤑 "+h(l.$t("earn.name")),1),s("div",pe,[s("div",ve,[s("div",fe," 📢 "+h(l.$t("earn.channels")),1),D.value?(d(),c("div",_e,[(d(!0),c(j,null,R((v=I(e).channels)==null?void 0:v.filter(t=>t.is_available&&!t.is_whale),t=>(d(),c("div",{key:t.id,onClick:g=>$(t,"visible"),class:"channel"},[s("div",we,[s("span",me,h(t.title),1)]),s("div",Ce,[t.is_available?(d(),c("span",ge,"🍆 "+h(t.reward.toLocaleString()),1)):w("",!0),ke])],8,ye))),128))])):w("",!0)]),s("div",xe,[s("div",be,[s("div",Se," 🐳 "+h(l.$t("whales.channels")),1),s("div",{style:{display:"flex",alignItems:"center"},onClick:H},[s("img",{src:I(se),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,De)])]),D.value?(d(),c("div",Ae,[(d(!0),c(j,null,R((f=I(e).whales)==null?void 0:f.filter(t=>t.is_available),t=>(d(),c("div",{key:t.id,onClick:g=>$(t,"visible"),class:"channel"},[s("div",Le,[s("span",Te,h(t.title),1)]),s("div",$e,[t.is_available?(d(),c("span",Me,"🍆 "+h(t.reward.toLocaleString()),1)):w("",!0),je])],8,Ie))),128))])):w("",!0)])]),r.value?(d(),c("div",{key:0,class:J(["boost-purchase-popup",{visible:r.value}])},[S((d(),c("div",Re,[s("div",Be,[s("h2",null,h(C.value=="create"?"Create whale":"Earn coins"),1),s("button",{class:"close-button",onClick:o[0]||(o[0]=t=>{r.value=!1})},Ve)]),C.value=="visible"?(d(),c("div",Ne,[s("p",null,h(i.value.status=="init"?l.$t("earn.waitRewardText"):l.$t("earn.selectedChannel")),1),s("p",null,"🍆"+h(i.value.reward),1),s("button",{class:"boost-purchase-button",onClick:o[1]||(o[1]=t=>i.value.status=="init"?F():V())},h(i.value.status=="init"?l.$t("earn.getRewardButton"):l.$t("earn.startRewardButton")),1)])):w("",!0),C.value=="create"?(d(),c("div",{key:1,class:"popup-body",onKeydown:o[5]||(o[5]=Q(()=>{},["enter"]))},[s("div",Ue,[Fe,S(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":o[2]||(o[2]=t=>u.value.title=t)},null,512),[[L,u.value.title]])]),s("div",He,[Pe,S(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":o[3]||(o[3]=t=>u.value.link=t)},null,512),[[L,u.value.link]])]),s("div",Ye,[qe,S(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":o[4]||(o[4]=t=>u.value.rewared=t)},null,512),[[L,u.value.rewared]])]),s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[s("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:P},"Создать")])],32)):w("",!0)])),[[p,U]])],2)):w("",!0)])}}}),Ke=te(ze,[["__scopeId","data-v-ee182305"]]);export{Ke as default};
