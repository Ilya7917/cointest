import{d as N,u as G,r as o,z as p,o as O,J as R,b as T,c as C,e as s,B as E,K as F,n as W,v as $,x as A,y as x,_ as J}from"./index-BHSb3jv9.js";import{u as P}from"./games-BT-LP9kU.js";const g=d=>(A("data-v-61c96226"),d=d(),x(),d),z=["width","height"],H={id:"unity-loading-bar"},V=g(()=>s("div",{id:"unity-logo"},null,-1)),j={id:"unity-progress-bar-empty"},D=g(()=>s("div",{id:"unity-webgl-logo"},null,-1)),L=g(()=>s("div",{id:"unity-build-title"},"FlappyDick",-1)),K=N({__name:"Town",setup(d){const r=P(),i=G(),w=o("unity-desktop"),v=o(960),h=o(600),y=o("0%"),f=o(!0),S=o(0),m=o(null),a=o(null),l=o(null),u="https://taptaptap.testcoin.uk/uploads/BuildTown",_=`${u}/buildes.loader.js`,b=e=>{y.value=`${100*e}%`,e==1&&console.log("load Finish")},k=()=>{var e;(e=a.value)==null||e.SetFullscreen(1)};window.GetSkins=function(){a.value.SendMessage("GameManager","OnInitSkins",i.skins)},window.GetLastVisit=function(){a.value.SendMessage("FoodSlider","OnSetFoodSlider",JSON.stringify(i.town))},window.GetEnergy=function(){var e,n;a.value.SendMessage("EmojiSlider","OnSetTownEmoji",JSON.stringify({energy:(e=i.user)==null?void 0:e.energy,energy_level:(n=i.user)==null?void 0:n.energy_level}))},window.TryBuy=function(e){if(console.log(e),!!i.user){if(i.user.balance<e){p().showAlert("У вас недостаточно 🐥 для покупки данной постройки");return}r.tryBuy(e).then(n=>{if(n){if(!i.user)return;i.user.balance-=e,a.value.SendMessage("WebGLCallbackHandler","OnAccept")}})}},window.GetReferals=function(){r.getReferals().then(e=>{console.log(e);const n={referals:e};a.value.SendMessage("Referal_Window","OnSetReferals",JSON.stringify(n))})},window.SaveJSON=function(e){console.log(e),r.saveUserBuildings(e).then(n=>{n&&(console.log(n),i.getTown())})},window.CheckUserIsland=function(e){console.log(e),r.checkReferalIsland(Number(e)).then(n=>{n?a.value.SendMessage("Referal_Window","VisitIsland"):a.value.SendMessage("Referal_Window","ReferalWithoutIsland")})},window.GetReferalTown=function(e){r.getReferalIsland(Number(e)).then(n=>{a.value.SendMessage("GameManager","OnSetReferalTown",n)})},window.window.GetBuildings=function(){r.getUserBuildings().then(e=>{a.value.SendMessage("GameManager","OnSetMyTown",e)})},window.GetReferalSkins=function(e){r.getReferalSkins(Number(e)).then(n=>{a.value.SendMessage("GameManager","OnInitSkins",n)})},window.IncreaseFood=function(e){if(i.user){if(i.user.balance<Number(e)){p().showAlert("Недостаточно коинов 🐥");return}r.onSetFood(Number(e)).then(n=>{if(n){if(!i.user)return;i.user.balance-=Number(e),a.value.SendMessage("FoodSlider","OnAcceptFood")}})}},O(async()=>{var e,n;if(((e=i.user)==null?void 0:e.id)!==void 0&&(S.value=(n=i.user)==null?void 0:n.id),/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const t=document.createElement("meta");t.name="viewport",t.content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes",document.getElementsByTagName("head")[0].appendChild(t),w.value="unity-mobile",v.value=window.innerWidth,h.value=window.innerHeight}f.value=!0;try{const t=await M();await B(_),await U(t),f.value=!1}catch(t){console.error("Ошибка загрузки или инициализации Unity:",t),alert(`Ошибка: ${t instanceof Error?t.message:t}`)}});async function M(){return{dataUrl:`${u}/buildes.data`,frameworkUrl:`${u}/buildes.framework.js`,codeUrl:`${u}/buildes.wasm`,streamingAssetsUrl:"",companyName:"DefaultCompany",productName:"DuckTown",productVersion:"0.1",showBanner:(e,n)=>{if(l.value){const t=document.createElement("div");t.innerHTML=e,l.value.appendChild(t),n==="error"?t.style.background="red":n==="warning"&&(t.style.background="yellow"),t.style.padding="10px",setTimeout(()=>{l.value&&l.value.removeChild(t)},5e3)}}}}async function B(e){return new Promise((n,t)=>{const c=document.createElement("script");c.src=e,c.onload=()=>n(),c.onerror=I=>t(I),document.body.appendChild(c)})}async function U(e){try{a.value=await createUnityInstance(m.value,e,b)}catch(n){throw new Error(`Ошибка инициализации Unity: ${n instanceof Error?n.message:String(n)}`)}}return R(()=>{a.value&&a.value.Quit().then(()=>{a.value=null})}),(e,n)=>(T(),C("div",{id:"unity-container",class:$(w.value)},[s("canvas",{id:"unity-canvas",ref_key:"canvas",ref:m,width:v.value,height:h.value,tabindex:"-1"},null,8,z),E(s("div",H,[V,s("div",j,[s("div",{id:"unity-progress-bar-full",style:W({width:y.value})},null,4)])],512),[[F,f.value]]),s("div",{id:"unity-warning",ref_key:"warningBanner",ref:l},null,512),s("div",{id:"unity-footer"},[D,s("div",{id:"unity-fullscreen-button",onClick:k}),L])],2))}}),X=J(K,[["__scopeId","data-v-61c96226"]]);export{X as default};
