import{u as k,j as le,k as S,D as ie,d as oe,l as re,E as ue,r as b,o as ce,q as de,c as r,t as h,m as p,e as a,F as N,p as z,v as $,G as L,g as x,x as E,H as ve,A as w,b as u,y as pe,z as he,_ as fe}from"./index-CsdKo7vP.js";import{A as ye,_ as _e}from"./addIcon-DfWGE30F.js";const we=k(),{setUser:me}=we,ge=le("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:i=>i.myChannels},actions:{async fetchChannels(){const i=k(),l=await S.get("https://taptaptap.testcoin.uk/channels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.channels=l.data},async fetchWhales(){const i=k(),l=await S.get("https://taptaptap.testcoin.uk/whales",{headers:{"x-api-key":i.getAccessToken}});this.whales=l.data,console.log(l.data)},async startChannel(i){const l=k(),t=await S.post("https://taptaptap.testcoin.uk/initUserChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return this.myChannels=t.data.channels,!0},async createWhale(i,l,t){var j;const f=k(),y=await S.post("https://taptaptap.testcoin.uk/createWhale",{balance:i,link:l,rewarded:t},{headers:{"x-api-key":f.getAccessToken}});return console.log(y),y.data.sucess?(((j=f.user)==null?void 0:j.balance)!=null&&(f.user.balance-=i),!0):!1},async getMyChannels(){const i=k(),l=await S.get("https://taptaptap.testcoin.uk/getMyChannels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.myChannels=ie(l.data.channels)},async rewardChannel(i){const l=k(),t=await S.post("https://taptaptap.testcoin.uk/getRewardFromChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),me(t.data.user),this.myChannels=t.data.channels,!0},async changeChannelAvailable(i){const l=k(),t=await S.post("https://taptaptap.testcoin.uk/changeChannelAvailable",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async deleteWhale(i){const l=k(),t=await S.post("https://taptaptap.testcoin.uk/deleteWhale",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async topUpWhale(i,l){const t=k(),f=await S.post("https://taptaptap.testcoin.uk/topUpWhale",{id:i,balance:l},{headers:{"x-api-key":t.getAccessToken}});return console.log(f.data),!0}}});function K(i){const l=Object.prototype.toString.call(i);return i instanceof Date||typeof i=="object"&&l==="[object Date]"?new i.constructor(+i):typeof i=="number"||l==="[object Number]"||typeof i=="string"||l==="[object String]"?new Date(i):new Date(NaN)}const be=36e5;function ke(i){return l=>{const f=(i?Math[i]:Math.trunc)(l);return f===0?0:f}}function xe(i,l){return+K(i)-+K(l)}function Ce(i,l,t){const f=xe(i,l)/be;return ke(t==null?void 0:t.roundingMethod)(f)}const C=i=>(pe("data-v-372e76a2"),i=i(),he(),i),O=_e+"#chevron-right",Ae={class:"telegram-channels"},Te={key:0,class:"earn-title"},Se={key:1,class:"createPostMenu"},Ie={style:{marginTop:"20px"}},$e={id:"progressbar"},De={class:"createForm"},Le={key:0,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},je=C(()=>a("label",{for:"fname"},"Ссылка на канал",-1)),Ue={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Re=C(()=>a("label",{for:"fname"},"Цена за переход",-1)),We={key:2,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Me=C(()=>a("label",{for:"fname"},"Баланс рекламного канала",-1)),Ve={key:0},Be={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:"15px"}},Pe={style:{textAlign:"center"}},Ne={style:{fontSize:"16px"}},ze={key:0,style:{display:"flex",justifyContent:"center"}},Ee={key:2,style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},Fe={style:{height:"40vh"}},He={class:"channels-title"},qe={key:0,class:"channels-list"},Ye=["onClick"],Ge={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Ke=["src"],Oe={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Ze={class:"name",style:{marginLeft:"10px"}},Je={class:"channel-action"},Qe={key:0,class:"reward"},Xe={key:1},et=C(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":O})],-1)),tt={style:{display:"flex",justifyContent:"space-between"}},st={class:"channels-title"},at=["src"],nt={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},lt=["onClick"],it={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},ot=["src"],rt={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},ut={class:"name",style:{marginLeft:"10px"}},ct={key:2},dt={class:"channel-action"},vt={key:0,class:"reward"},pt={key:1},ht=C(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":O})],-1)),ft={class:"popup-content"},yt={class:"popup-header"},_t=C(()=>a("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[a("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),wt=[_t],mt={key:0,class:"popup-body"},gt={key:1,class:"popup-body"},bt={key:0},kt={key:1},xt={key:2},Ct={key:3,style:{marginTop:"15px"}},At={key:4,style:{marginTop:"15px"}},Tt=C(()=>a("span",null,"Насколько желаете пополнить кита?🐳",-1)),St={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},It=C(()=>a("label",{for:"fname"},"Баланс кита",-1)),$t={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Dt=C(()=>a("label",{for:"fname"},"Цена за переход",-1)),Lt={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},jt=C(()=>a("label",{for:"fname"},"Ссылка на канал",-1)),Ut=oe({__name:"Channels",setup(i){const{t:l}=re(),t=ge(),f=ue(),y=b(!1),j=b(!1),I=k(),_=b(0),o=b({id:0,title:"",reward:0,balance:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),R=()=>{t.fetchChannels().then(()=>{t.getMyChannels().then(()=>{var s,v,d,g;((s=t.myChannels)==null?void 0:s.length)!=null&&((v=t.myChannels)==null?void 0:v.length)>0&&((d=t.myChannels)==null||d.map(e=>{var m,G;if(console.log(e),e.Status=="init"){let T=(m=t.channels)==null?void 0:m.findIndex(P=>P.id==e.ChannelID);t.channels&&T!=null&&T!=-1&&(t.channels[T].is_available=!0,console.log(t.channels[T].is_available))}if(e.Status=="rewarded"){let T=(G=t.channels)==null?void 0:G.findIndex(P=>P.id==e.ChannelID);t.channels&&T!=null&&T!=-1&&(t.channels[T].is_available=!1,console.log(t.channels[T].is_available))}}));let n=[];(g=t.channels)==null||g.map(e=>{e.is_whale&&n.push(e)}),t.whales=n.length>0?n:[],n.sort((e,m)=>e.user_id===_.value&&m.user_id!==_.value?-1:e.user_id!==_.value&&m.user_id===_.value?1:e.available&&!m.available?-1:!e.available&&m.available?1:e.is_available&&!m.is_available?-1:!e.is_available&&m.is_available?1:0),console.log(t.whales),j.value=!0})})};ce(()=>{var n,s;R(),((n=I.user)==null?void 0:n.id)!=null&&(_.value=(s=I.user)==null?void 0:s.id)});const F=(n,s)=>{var v,d,g;if(!n.available&&n.user_id!=_.value){console.log("channel is not available"),w().showAlert(l("У кита закончился баланс 🍆")),f.openTelegramLink(n.invite_link);return}if(((v=t.myChannels)==null?void 0:v.length)!=null&&((d=t.myChannels)==null?void 0:d.length)>0){let e=t.myChannels.findIndex(m=>m.ChannelID==n.id);console.log(e),e!=-1?(o.value.status=t.myChannels[e].Status,o.value.createdAt=((g=t.myChannels[e].CreatedAt)==null?void 0:g.toLocaleString())||""):(o.value.status="",o.value.createdAt="")}console.log(t.myChannels),o.value.id=n.id,o.value.balance=n.balance,o.value.owner_id=n.user_id,o.value.reward=n.reward,o.value.title=n.title,o.value.invite_link=n.invite_link,o.value.available=n.available,o.value.is_available=n.is_available,y.value=!1,U.value=s,setTimeout(J,100)},Z=()=>{const n={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,available:!0,reward:0,balance:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};t.startChannel(n).then(s=>{if(s){y.value=!1,t.getMyChannels();try{f.openTelegramLink(o.value.invite_link)}catch{console.log("Err")}}})},J=()=>{y.value=!0};function Q(){U.value!="create"&&(y.value=!1)}const X=()=>{console.log("check time: "+o.value.createdAt);const n=new Date(o.value.createdAt),v=Ce(new Date,n);if(console.log("check time: "+o.value.createdAt),console.log("Hours since request: "+v),v>=1){const d={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,reward:0,is_available:!0,available:!0,balance:0,channel_avatar:"",is_whale:!1,user_id:0};t.rewardChannel(d).then(()=>{if(console.log("request finished"),y.value=!1,t.channels){var g=t.channels.findIndex(e=>e.id==o.value.id);t.channels[g].is_available=!1}o.value.status="",o.value.createdAt=""})}else w().showAlert(l("earn.waitRewardText"))},U=b("visible"),c=b({balance:0,link:"",rewared:0});function H(n){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(n)}async function q(){var n,s;if(!(c.value.link===""||c.value.rewared==0)){if(!H(c.value.link)){console.error("Invalid Telegram URL format"),w().showAlert(l("Invalid Telegram URL format"));return}if(I.user!=null&&c.value.balance>((n=I.user)==null?void 0:n.balance)){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}if(c.value.balance==0){w().showAlert(l("Баланс канала рекламы не может быть 0🍆"));return}if(c.value.balance<1e4){w().showAlert(l("Баланс рекламы канала не может быть меньше 10.000🍆"));return}if(c.value.rewared>c.value.balance){w().showAlert(l("❌ Вы не можете выдавать юзерам больше, чем будет на балансе рекламы канала ❌"));return}if(t.channels!=null&&t.channels.findIndex(d=>d.user_id==_.value)!=-1){let d=t.channels.filter(g=>g.user_id==_.value).length;if(d>0&&I.user!=null&&((s=I.user)==null?void 0:s.balance)<d*1e4+c.value.balance){w().showAlert(l("У вас недостаточно 🍆 чтобы создать ещё один рекламный канал"));return}}V.value=!1,t.createWhale(c.value.balance,c.value.link,c.value.rewared).then(v=>{v?(R(),y.value=!1,V.value=!0,M.value="channels",A.value=0,B.forEach(d=>{d.id!=0&&(d.isActive=!1)})):(w().showAlert(l("🐳 Ошибка при создании канала, попробуйте попытку позже")),V.value=!0)})}}const ee=n=>{n.target.blur()},te=n=>{var v;const s=(v=t.whales)==null?void 0:v.findIndex(d=>d.id==n);s!=-1&&s!=null&&t.whales!=null&&t.whales[s].id==n&&t.changeChannelAvailable(n).then(d=>{d&&(y.value=!1,R())})},se=n=>{var v;const s=(v=t.whales)==null?void 0:v.findIndex(d=>d.id==n);s!=-1&&s!=null&&t.whales!=null&&t.whales[s].id==n&&t.deleteWhale(n).then(d=>{d&&(y.value=!1,R())})},D=b("view"),W=b(0),ae=n=>{if(I.user!=null){if(W.value==0){w().showAlert(l("Нельзя пополнить на 0 🍆"));return}if(I.user.balance<W.value){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}t.topUpWhale(n,W.value).then(s=>{s&&(y.value=!1,D.value="view",R())})}},M=b("channels"),A=b(0),Y=n=>{M.value=n},V=b(!0),B=[{id:0,isActive:!0,text:"Add link"},{id:1,isActive:!1,text:"Price per transition"},{id:2,isActive:!1,text:"Add balance"}],ne=()=>{if(A.value==0&&!H(c.value.link)){w().showAlert(l("Invalid Telegram URL format"));return}if(A.value==1){if(c.value.rewared<=0){w().showAlert(l("❌ Цена за переход не может быть меньше 0 🍆 ❌"));return}if(c.value.rewared<500){w().showAlert(l("❌ Цена за переход не может быть меньше 500 🍆 ❌"));return}}A.value++,B[A.value].isActive=!0};return(n,s)=>{var d,g;const v=de("click-outside");return u(),r("div",Ae,[M.value!="create"?(u(),r("div",Te," 🤑 "+h(n.$t("earn.name")),1)):p("",!0),M.value==="create"?(u(),r("div",Se,[a("button",{class:"mypost-button",style:{marginTop:"10px"},onClick:s[0]||(s[0]=e=>Y("channels"))},"Назад"),a("div",Ie,[a("ul",$e,[(u(),r(N,null,z(B,e=>a("li",{class:E(e.isActive?"active":"")},h(e.text),3)),64))])]),a("div",De,[A.value===0?(u(),r("div",Le,[je,$(a("input",{type:"text",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":s[1]||(s[1]=e=>c.value.link=e)},null,512),[[L,c.value.link]])])):p("",!0),A.value===1?(u(),r("div",Ue,[Re,$(a("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":s[2]||(s[2]=e=>c.value.rewared=e)},null,512),[[L,c.value.rewared]])])):p("",!0),A.value===2?(u(),r("div",We,[Me,$(a("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":s[3]||(s[3]=e=>c.value.balance=e)},null,512),[[L,c.value.balance]]),V.value?(u(),r("div",Ve,[a("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:s[4]||(s[4]=e=>q())},"Создать")])):p("",!0),((d=x(t).whales)==null?void 0:d.findIndex(e=>e.user_id==_.value))!=-1?(u(),r("div",Be,[a("div",Pe,[a("span",Ne,"⚠️ Стоимость создания рекламного канала будет "+h(x(t).whales?x(t).whales.filter(e=>e.user_id==_.value).length*1e4:0)+"🍆, т.к вы уже имеете "+h(x(t).whales?x(t).whales.filter(e=>e.user_id==_.value).length:0)+" канала ⚠️",1)])])):p("",!0)])):p("",!0)]),A.value<2?(u(),r("div",ze,[a("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:ne},"Дальше")])):p("",!0)])):p("",!0),M.value=="channels"?(u(),r("div",Ee,[a("div",Fe,[a("div",He," 📢 "+h(n.$t("earn.channels")),1),j.value?(u(),r("div",qe,[(u(!0),r(N,null,z((g=x(t).channels)==null?void 0:g.filter(e=>!e.is_whale),e=>(u(),r("div",{key:e.id,onClick:m=>e.is_available?F(e,"visible"):x(f).openTelegramLink(e.invite_link),class:"channel"},[a("div",Ge,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Ke)):(u(),r("div",Oe,"📢")),a("span",Ze,h(e.title),1)]),a("div",Je,[e.is_available?(u(),r("span",Qe,"🍆 "+h(e.reward.toLocaleString()),1)):(u(),r("span",Xe,"Награда получена")),et])],8,Ye))),128))])):p("",!0)]),a("div",null,[a("div",tt,[a("div",st," 🐳 "+h(n.$t("whales.channels")),1),a("div",{style:{display:"flex",alignItems:"center"},onClick:s[5]||(s[5]=e=>Y("create"))},[a("img",{src:x(ye),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,at)])]),j.value?(u(),r("div",nt,[(u(!0),r(N,null,z(x(t).whales,e=>(u(),r("div",{key:e.id,onClick:m=>e.is_available?F(e,"visible"):x(f).openTelegramLink(e.invite_link),class:E(e.available?"channel":"channel-disable")},[a("div",it,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,ot)):(u(),r("div",rt,"🐳")),a("span",ut,h(e.title),1),e.user_id==_.value?(u(),r("span",ct,"👑")):p("",!0)]),a("div",dt,[e.is_available?(u(),r("span",vt,"🍆 "+h(e.reward.toLocaleString()),1)):(u(),r("span",pt,"Награда получена")),ht])],10,lt))),128))])):p("",!0)])])):p("",!0),y.value?(u(),r("div",{key:3,class:E(["boost-purchase-popup",{visible:y.value}])},[$((u(),r("div",ft,[a("div",yt,[a("h2",null,h(U.value=="create"?"Create whale":o.value.title),1),a("button",{class:"close-button",onClick:s[6]||(s[6]=e=>{y.value=!1})},wt)]),U.value=="visible"&&o.value.owner_id!=_.value?(u(),r("div",mt,[a("p",null,h(o.value.status=="init"?n.$t("earn.waitRewardText"):n.$t("earn.selectedChannel")),1),a("p",null,"🍆"+h(o.value.reward),1),a("button",{class:"boost-purchase-button",onClick:s[7]||(s[7]=e=>o.value.status=="init"?X():Z())},h(o.value.status=="init"?n.$t("earn.getRewardButton"):n.$t("earn.startRewardButton")),1)])):p("",!0),U.value=="visible"&&o.value.owner_id==_.value?(u(),r("div",gt,[D.value=="view"?(u(),r("p",bt,"Этот канал принадлежит вам")):p("",!0),D.value=="view"?(u(),r("p",kt,"Награда за переход: 🍆"+h(o.value.reward),1)):p("",!0),D.value=="view"?(u(),r("p",xt,"Оставшийся баланс рекламы: 🍆"+h(o.value.balance),1)):p("",!0),D.value=="view"?(u(),r("div",Ct,[a("button",{class:"boost-purchase-button",onClick:s[8]||(s[8]=e=>te(o.value.id))},h(o.value.available?"Остановить":"Включить"),1),a("button",{class:"boost-purchase-button",onClick:s[9]||(s[9]=e=>D.value="topUp"),style:{marginTop:"15px"}},"Пополнить"),a("button",{class:"boost-purchase-button",style:{marginTop:"15px"},onClick:s[10]||(s[10]=e=>se(o.value.id))},"Удалить")])):(u(),r("div",At,[Tt,$(a("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[11]||(s[11]=e=>W.value=e)},null,512),[[L,W.value]]),a("button",{class:"boost-purchase-button",onClick:s[12]||(s[12]=e=>ae(o.value.id)),style:{marginTop:"15px"}},"Пополнить"),a("button",{class:"boost-purchase-button",onClick:s[13]||(s[13]=e=>D.value="view"),style:{marginTop:"15px"}},"Назад")]))])):p("",!0),U.value=="create"?(u(),r("div",{key:2,class:"popup-body",onKeydown:ve(ee,["enter"]),style:{overflowY:"scroll"}},[a("div",St,[It,$(a("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[14]||(s[14]=e=>c.value.balance=e)},null,512),[[L,c.value.balance]])]),a("div",$t,[Dt,$(a("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[15]||(s[15]=e=>c.value.rewared=e)},null,512),[[L,c.value.rewared]])]),a("div",Lt,[jt,$(a("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[16]||(s[16]=e=>c.value.link=e)},null,512),[[L,c.value.link]])]),a("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[a("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:q},"Создать")])],32)):p("",!0)])),[[v,Q]])],2)):p("",!0)])}}}),Mt=fe(Ut,[["__scopeId","data-v-372e76a2"]]);export{Mt as default};
